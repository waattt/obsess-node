<html>
    <head>
        <title>Obsess-node</title>
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		
		<link rel="stylesheet" type="text/css" href="css/style.css">
				
        <script src="socket.io/socket.io.js"></script>
        <script src="js/jquery-2.1.1.min.js"></script> 
        <script src="js/jquery-visibility.js"></script> 
    </head>
    <body>
        <div class="wrapper">
            <a href="#" id="switchButton">turn on</a>
			<div>
				<ul id="messages"></ul>
			</div>
			<div id="usersConnected"></div>
		</div>
        <script>
            $(function(){
                var socket = io.connect('http://192.168.2.9:8080');
 
                socket.on('connect', function() {
                    $('#messages').append('<li>Connected to the server.</li>');            
                });
 
                socket.on('message', function(message) {    
                    $('#messages').append('<li>' + message + '</li>');
                });
 
                socket.on('disconnect', function() {
                    $('#messages').append('<li>Disconnected from the server.</li>');            
                });
				$(document).on('hide', function() {
				  // the page was hidden. This is used to fix the issue with not disconnection a socket on mobile.
				  socket.disconnect();
				});
 
                $('#switchButton').bind('click', function() {
                    var message = $('#switchButton').text();
                    socket.send(message);
                    $('#messages').append('<li>me: ' + message + '</li>');
 
                    if (message == 'turn on')
                        $('#switchButton').text('turn off');
                    else 
                        $('#switchButton').text('turn on');
                });   
		
				// New socket connected, display new count on page
				socket.on('users connected', function(data){
					$('#usersConnected').html('Users connected: ' + data);
				});
            });
        </script>
    </body>
</html>